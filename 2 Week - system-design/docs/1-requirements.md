# 1. 문제 정의

이커머스 서비스의 사용자는 사용자의 계좌에 충전한 금액을 이용해 상품을 구매할 수 있다.

<br>

## 1.1. 주요 기능(API)

| 주요 기능(API)  | 역할                           |
|-------------|------------------------------|
| 잔액 충전       | 사용자의 계좌에 금액 충전               |
| 잔액 조회       | 사용자의 현재 잔액 조회                |
| 상품 조회       | 상품 목록, 가격, 잔여 수량 조회          |
| 선착순 쿠폰      | 선착순으로 할인 쿠폰 발급 & 유효 여부 확인    |
| 주문          | 구매할 상품과 수량 선택 & 주문 요청 생성     |
| 결제          | 사용자의 계좌에서 주문 금액을 차감          |
| 인기 판매 상품 조회 | 최근 3일간 판매량을 집계하여 상위 5개 상품 추천 |

<br>

## 1.2. 기능적 요구사항

기능적 요구사항과 비기능적 요구사항에 대해 정리하였다.

<br>

### 기능적 요구사항

> 어떤 기능을 제공할 수 있어야 하는가? 

#### 1. 잔액 충전

- 사용자는 충전할 금액을 입력하여 충전 요청을 보낼 수 있어야 한다.
- 충전이 완료되면 사용자의 잔액이 요청 금액만큼 증가하여 반영되어야 한다.
- 충전 금액이 0 이하이거나 비정상적일 경우 **에러 페이지**를 반환해야 한다.

#### 2. 잔액 조회

- 사용자는 자신의 계좌 ID로 현재 잔액을 조회할 수 있어야 한다.
- 조회 대상 사용자가 존재하지 않을 경우 **에러 페이지**를 반환해야 한다.

#### 3. 상품 조회

- 사용자는 전체 상품 목록을 조회할 수 있어야 한다.
- 각 상품 정보에는 상품ID, 상품명, 가격, 남은 재고 수량이 포함되어야 한다.
- 조회 결과가 없을 경우 **상품이 존재 하지 않는다는 메시지**를 반환해야 한다.

#### 4. 선착순 쿠폰

- 사용자는 선착순 제한 수량 내에서 쿠폰 발급 요청을 보낼 수 있어야 한다.
- 이미 쿠폰을 발급받은 사용자는 중복 발급을 받을 수 없어야 한다.
- 쿠폰이 모두 발급 된 경우 **선착순 이벤트 종료 메시지**를 반환해야 한다.
- 유효한 쿠폰을 포함하여 주문할 경우 전체 금액에 대해 할인 받을 수 있어야 한다.
- 유효하지 않은 쿠폰은 주문 시 적용되지 않으며 **에러 페이지**를 반환해야 한다.

#### 5. 주문

- 사용자는 복수의 상품 ID와 수량을 포함한 주문 요청을 생성할 수 있어야 한다.
- 요청된 수량이 재고보다 많으면 **에러 메시지**를 반환해야 한다.
- 주문 요청이 정상 생성되면 임시 주문 리소스가 생성되어야 한다.

#### 6. 결제

- 사용자는 주문 ID로 결제 요청을 수행할 수 있어야 한다.
- 사용자의 잔액이 주문 금액보다 부족하면 **충전 요청 메시지**를 반환해야 한다.
- 결제 성공 시 사용자의 잔액과 상품 재고가 동시에 차감되어야 한다.
- 주문 정보는 외부 플랫폼으로 전송되어야 한다.
- 결제 완료 후 마이페이지에서 주문 내역을 확인할 수 있어야 한다.

#### 7. 인기 판매 상품 조회

- 사용자는 최근 3일간 판매량을 기준으로 상위 5개 상품을 조회할 수 있어야 한다.
- 판매량 집계 시 대량의 트래픽에도 응답 성능을 보장해야 한다.
- 데이터가 충분하지 않을 경우 판매량이 높은 순으로 가능한 만큼 반환해야 한다.

<br>

### 비기능적 요구사항

> 성능, 확장성, 보안 관련한 추가적인 고려사항들을 고려할 수 있어야 한다.

#### 1. 데이터 정합성

- ACID 트랜잭션 : 잔액, 재고 업데이트 시 데이터 일관성 보장
- 동시성 제어 : 분산 락등 경쟁 상태 방지
- 다중 인스턴스 : MSA 환경에서 잔액과 재고 정합성 유지

#### 2. 성능 및 확장성 

- 성능 보장 : 인기 상품 조회 등 집계 API의 트래픽 급증 시 응답 성능 유지
- 재고 관리 : 동시성 이슈 방지 및 재고 소진 오류 방지

#### 3. 보안

- 비인가자의 상품 조회, 잔액 충전, 잔액 조회 차단
- 비정상적인 상품 조회, 구매요청, 쿠폰 발급 요청등 차단
- SQL Injection 차단(기타 유사한 방법 모두 포함)
- 서버 응답(Header, Body)의 불필요한 정보 삭제
- 예외 상황 발생 시 기본적으로 에러 페이지 반환









